global
    maxconn 50000
    log /dev/log local0
    daemon

defaults
    mode tcp
    log global
    option tcplog
    timeout connect 5s
    timeout client  1m
    timeout server  1m

# Frontends for external ports (range generated by poolproxyctl)
# Example: bind :40000-40499 v4v6
frontend connexa_front
    bind 0.0.0.0:{{PORT_RANGE_START}}-{{PORT_RANGE_END}}
    tcp-request connection accept if { src -f /etc/connexa/whitelist.acl }  # direct (no-auth) path
    use_backend noauth_backend if { src -f /etc/connexa/whitelist.acl }
    default_backend auth_backend

backend auth_backend
    mode tcp
    # Per-node mapping to 3proxy AUTH listeners, e.g. 127.0.0.1:41xxx
    # filled by poolproxyctl render
    server-template n- 127.0.0.1:41000-42000 maxconn 100 check disabled

backend noauth_backend
    mode tcp
    # Per-node mapping to 3proxy NOAUTH listeners, e.g. 127.0.0.1:42xxx
    server-template n- 127.0.0.1:42000-43000 maxconn 100 check disabled
